# FreeRADIUS TLS/SSL Certificates (Production Only)

This directory contains the **production** certificates used by FreeRADIUS for EAP-TTLS/PEAP authentication.

**Note:** Development (`docker-compose.yml`) uses self-signed certificates auto-generated by FreeRADIUS.
These certificates are only mounted when deploying with `docker-compose.production.yml`.

## Required Files

Place the following certificate files in this directory before deploying:

1. **server.key** - Private key for the RADIUS server
2. **server.pem** - Server certificate (PEM format)
3. **ca.pem** - CA certificate chain (PEM format)

## Certificate Requirements

### Server Certificate (server.pem)
- Must be in PEM format
- Common Name (CN) or Subject Alternative Name (SAN) should match your RADIUS server hostname
- Can be from:
  - Let's Encrypt (free, automated)
  - Commercial CA (DigiCert, Sectigo, etc.)
  - Internal PKI

### Private Key (server.key)
- Must be in PEM format
- Should NOT be password-protected (or update the EAP config to include the password)
- Keep this file secure - never commit to version control

### CA Certificate (ca.pem)
- Full certificate chain from your CA
- Include intermediate certificates if applicable
- Format example:
  ```
  -----BEGIN CERTIFICATE-----
  [Root CA Certificate]
  -----END CERTIFICATE-----
  -----BEGIN CERTIFICATE-----
  [Intermediate CA Certificate]
  -----END CERTIFICATE-----
  ```

## Example: Let's Encrypt Certificates

If using Let's Encrypt:

```bash
# After running certbot
cp /etc/letsencrypt/live/radius.yourdomain.com/privkey.pem ./server.key
cp /etc/letsencrypt/live/radius.yourdomain.com/fullchain.pem ./server.pem
cp /etc/letsencrypt/live/radius.yourdomain.com/chain.pem ./ca.pem
```

## Example: Convert Other Formats

### From .crt and .key files
```bash
# If you already have PEM format
cp your-server.key ./server.key
cp your-server.crt ./server.pem
cp your-ca.crt ./ca.pem
```

### From .pfx/.p12 file
```bash
# Extract private key
openssl pkcs12 -in certificate.pfx -nocerts -out server.key -nodes

# Extract certificate
openssl pkcs12 -in certificate.pfx -clcerts -nokeys -out server.pem

# Extract CA chain
openssl pkcs12 -in certificate.pfx -cacerts -nokeys -out ca.pem
```

### From .der format
```bash
# Convert DER to PEM
openssl x509 -inform der -in certificate.der -out server.pem
```

## File Permissions

Permissions are automatically set by the Docker entrypoint script, but for reference:

```bash
# On Linux/macOS before deployment
chmod 600 server.key
chmod 644 server.pem
chmod 644 ca.pem
```

## Security Notes

1. **Never commit these files to Git** - They are listed in .gitignore
2. **Rotate certificates before expiration** - Set up monitoring for expiration dates
3. **Use strong keys** - Minimum 2048-bit RSA or 256-bit ECC
4. **Keep private keys secure** - Limit access to authorized personnel only

## Deployment

### Development (Self-Signed Certificates)

Development uses FreeRADIUS's built-in self-signed certificates:

```bash
docker-compose up -d
```

No certificate setup needed - FreeRADIUS generates them automatically.

### Production (Real Certificates)

Once your production certificates are in place:

```bash
# Verify files exist
ls -la

# Deploy with production configuration
docker-compose -f docker-compose.yml -f docker-compose.production.yml up -d

# Verify certificates are loaded
docker-compose logs freeradius | grep -i certificate
```

## Troubleshooting

**Certificate not found error:**
- Ensure files are named exactly: `server.key`, `server.pem`, `ca.pem`
- Check file permissions
- Verify paths in docker-compose.yml

**Certificate validation fails:**
- Verify certificate chain is complete
- Check that CN/SAN matches expected hostname
- Ensure certificate is not expired: `openssl x509 -in server.pem -noout -dates`

**Permission denied errors:**
- The Docker entrypoint script handles permissions automatically
- Check Docker volume mounts are correct
